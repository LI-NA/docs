<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Standard Notes Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Standard Notes Documentation Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Standard Notes Documentation" href="/opensearch.xml">
<link rel="stylesheet" href="/katex/v0.12.0/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script src="/matomo.js" async defer="defer"></script><title data-react-helmet="true">Encryption Protocol Specification v003 | Standard Notes Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Encryption Protocol Specification v003 | Standard Notes Documentation"><meta data-react-helmet="true" name="description" content="Specification for the Standard Notes end-to-end encryption."><meta data-react-helmet="true" property="og:description" content="Specification for the Standard Notes end-to-end encryption."><meta data-react-helmet="true" name="keywords" content="standard notes,docs,notes app,end-to-end encryption,encryption specification"><meta data-react-helmet="true" property="og:image" content="https://docs.standardnotes.org/img/logo.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.standardnotes.org/img/logo.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Encryption Protocol Specification v003"><meta data-react-helmet="true" property="og:url" content="https://docs.standardnotes.org/specification/encryption/003/"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://docs.standardnotes.org/specification/encryption/003/"><link rel="stylesheet" href="/styles.ef58e168.css">
<link rel="stylesheet" href="/main.a70d416a.css">
<link rel="preload" href="/styles.f3353c29.js" as="script">
<link rel="preload" href="/runtime~main.27aa97a1.js" as="script">
<link rel="preload" href="/main.4fbd0b91.js" as="script">
<link rel="preload" href="/1.f786a897.js" as="script">
<link rel="preload" href="/85.c42d0e7f.js" as="script">
<link rel="preload" href="/89.f32036f2.js" as="script">
<link rel="preload" href="/935f2afb.6b1e2732.js" as="script">
<link rel="preload" href="/84.3088d7e3.js" as="script">
<link rel="preload" href="/b2ddf031.08057054.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_17Wu navbarHidden_19ww"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Standard Notes Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="Standard Notes Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Standard Notes</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Usage</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/usage/">General</a></li><li><a class="dropdown__link" position="right" href="/usage/what-are-editors/">Editors</a></li><li><a class="dropdown__link" position="left" href="/usage/folders/">Folders</a></li><li><a class="dropdown__link" position="left" href="/usage/tags/">Tags</a></li><li><a class="dropdown__link" position="left" href="/usage/backups/">Backups</a></li><li><a class="dropdown__link" position="left" href="/usage/filesafe/">FileSafe</a></li><li><a class="dropdown__link" position="left" href="/usage/2fa/">Two-factor Auth</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Listed</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/listed/about/">About</a></li><li><a class="dropdown__link" position="left" href="/listed/register/">Register</a></li><li><a class="dropdown__link" position="left" href="/listed/publishing/">Publish</a></li><li><a class="dropdown__link" position="left" href="/listed/settings/">Settings</a></li><li><a class="dropdown__link" position="left" href="/listed/subscribers/">Subscribers</a></li><li><a class="dropdown__link" position="left" href="/listed/guestbook/">Guestbook</a></li><li><a class="dropdown__link" position="left" href="/listed/styles/">Customize Styles</a></li><li><a class="dropdown__link" position="left" href="/listed/options/">Per-post Options</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Self-Hosting</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/self-hosting/getting-started/">Getting Started</a></li><li><a class="dropdown__link" position="left" href="/self-hosting/docker/">Docker</a></li><li><a class="dropdown__link" position="left" href="/self-hosting/managing-options/">Managing Options</a></li><li><a class="dropdown__link" position="left" href="/self-hosting/https-support/">HTTPS Support</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://standardnotes.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Website</a><a href="https://standardnotes.org/help" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Help</a><a href="https://blog.standardnotes.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://github.com/standardnotes/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://github.com/sn-extensions/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Extensions</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Standard Notes Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="Standard Notes Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Standard Notes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Usage</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/usage/">General</a></li><li class="menu__list-item"><a class="menu__link" position="right" href="/usage/what-are-editors/">Editors</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/usage/folders/">Folders</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/usage/tags/">Tags</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/usage/backups/">Backups</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/usage/filesafe/">FileSafe</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/usage/2fa/">Two-factor Auth</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Listed</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/listed/about/">About</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/listed/register/">Register</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/listed/publishing/">Publish</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/listed/settings/">Settings</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/listed/subscribers/">Subscribers</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/listed/guestbook/">Guestbook</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/listed/styles/">Customize Styles</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/listed/options/">Per-post Options</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Self-Hosting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/self-hosting/getting-started/">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/self-hosting/docker/">Docker</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/self-hosting/managing-options/">Managing Options</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/self-hosting/https-support/">HTTPS Support</a></li></ul></li><li class="menu__list-item"><a href="https://standardnotes.org/" target="_blank" rel="noopener noreferrer" class="menu__link">Website</a></li><li class="menu__list-item"><a href="https://standardnotes.org/help" target="_blank" rel="noopener noreferrer" class="menu__link">Help</a></li><li class="menu__list-item"><a href="https://blog.standardnotes.org" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://github.com/standardnotes/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://github.com/sn-extensions/" target="_blank" rel="noopener noreferrer" class="menu__link">Extensions</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy sidebarWithHideableNavbar_CROi"><a tabindex="-1" class="sidebarLogo_xFc8" href="/"><img src="/img/logo.png" alt="Standard Notes Logo" class="themedImage_YANc themedImage--light_3CMI"><img src="/img/logo.png" alt="Standard Notes Logo" class="themedImage_YANc themedImage--dark_3ARp"><strong>Standard Notes</strong></a><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Standard Notes Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">Welcome</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Usage</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/">General Usage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/install-extensions/">Install Extensions</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Mobile</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/mobile/">Mobile</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Editors</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/what-are-editors/">What are editors?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/bold-editor">Bold Editor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/markdown-basic">Markdown Basic</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/markdown-math">Markdown Math</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/markdown-pro">Markdown Pro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/secure-spreadsheets">Secure Spreadsheets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/task-editor">Task Editor</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Folders and Tags</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/folders">Folders</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/tags">Smart Tags</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/autocomplete-tags">Autocomplete Tags</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Actions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/action-bar">Action Bar</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/github-push/">GitHub Push</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Data Care</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/backups/">Backups</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/email-backups/">Email Backups</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/cloud-backups/">Cloud Backups</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/note-history/">Note History</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">FileSafe</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/filesafe/">FileSafe 101</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/filesafe/aws/">Amazon S3</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Two-factor Authentication</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/2fa/">How to enable 2FA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/2fa/store-secret-key/">Store 2FA secret keys</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/usage/2fa/lost-secret-key/">Lost 2FA secret key</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Listed</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/listed/about">About Listed</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/listed/register">Register</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/listed/publishing">Publish articles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/listed/settings">Settings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/listed/subscribers">Email Subscribers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/listed/guestbook">Guest Book</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/listed/styles">Customize Styles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/listed/options">Per-Post Options</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Self-Hosting a Sync Server</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/self-hosting/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/self-hosting/docker">Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/self-hosting/heroku">Heroku</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/self-hosting/ec2-nginx">EC2 and Nginx</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/self-hosting/raspberry-pi">Raspberry Pi</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/self-hosting/managing-options">Managing options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/self-hosting/https-support">Securing HTTP traffic of your Sync server</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Building Extensions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/extensions/intro">Intro to Extensions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/extensions/building-an-extension">Building an Extension</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Editors</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/extensions/editorkit">EditorKit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/extensions/stylekit">StyleKit</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/extensions/local-setup">Local Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/extensions/themes">Themes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/extensions/actions">Actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/extensions/publishing">Publishing</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Specification</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/specification/encryption/">Encryption v004</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/specification/encryption/003/">Encryption v003</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/specification/sync">Sync</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute">How to contribute</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2WRA"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_CoMu"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Encryption Protocol Specification v003</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="version-003"></a>Version 0.0.3<a class="hash-link" href="#version-003" title="Direct link to heading">#</a></h2><p>It is important that there exist a separation of concerns between the server and the client. That is, the client should not trust the server, and vice versa.</p><p>Encryption keys are generated by stretching the user&#x27;s input password using a <a href="https://en.wikipedia.org/wiki/Key_derivation_function" target="_blank" rel="noopener noreferrer">key derivation function.</a></p><p>The resulting key is split in three â€” the first third is sent to the server as the user&#x27;s password, the second third is saved locally as the user&#x27;s master encryption key, and the last third is used as an authentication key. In this setup, the server is never able to compute the encryption key or the user&#x27;s original password given just a fraction of the resulting key.</p><p>Note: client-server connections must be made securely through SSL/TLS.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="elaboration-on-user-model-encryption-related-fields"></a>Elaboration on User model encryption related fields<a class="hash-link" href="#elaboration-on-user-model-encryption-related-fields" title="Direct link to heading">#</a></h4><table><thead><tr><th>name</th><th>details</th></tr></thead><tbody><tr><td>pw_cost</td><td>The number of iterations to be used by the KDF. The minimum for version 003 is 100,000. However note that non-native clients (web clients not using WebCrypto) will not be able to handle any more than 3,000 iterations.</td></tr><tr><td>pw_nonce</td><td>A nonce for password derivation. This value is initially created by the client during registration.</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="key-generation"></a>Key Generation<a class="hash-link" href="#key-generation" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="client-instructions"></a>Client Instructions<a class="hash-link" href="#client-instructions" title="Direct link to heading">#</a></h3><p>Given a user inputted password <code>uip</code>, the client&#x27;s job is to generate a password <code>pw</code> to send to the server, a master key <code>mk</code> that the user stores locally to encrypt/decrypt data, and an auth key <code>ak</code> for authenticating encrypted data.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="login-steps"></a>Login Steps<a class="hash-link" href="#login-steps" title="Direct link to heading">#</a></h4><ol><li><p>Client makes GET request with user&#x27;s email to <code>auth/params</code> to retrieve password nonce, cost, and version.</p></li><li><p>Client verifies cost &gt;= minimum cost (100,000 for 003.)</p></li><li><p>Client computes <code>pw</code>, <code>mk</code>, and <code>ak</code> using PBKDF2 with SHA512 as the hashing function and output length of 768 bits:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">salt = SHA256:Hexdigest([email, &quot;SF&quot;, version, pw_cost, pw_nonce].join(&quot;:&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">key = pbkdf2(uip, salt, sha512, 768, pw_cost) // hex encoded</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pw = key.substring(0, key.length/3)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mk = key.substring(key.length/3, key.length/3)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ak = key.substring(key.length/3 * 2, key.length/3)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Client sends <code>pw</code> to the server as the user&#x27;s &quot;regular&quot; password and stores <code>mk</code> and <code>ak</code> locally. (<code>mk</code> and <code>ak</code> are never sent to the server).</p></li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="registration-steps"></a>Registration Steps<a class="hash-link" href="#registration-steps" title="Direct link to heading">#</a></h4><ol><li><p>Client chooses default for <code>pw_cost</code> (minimum 100,000).</p></li><li><p>Client generates <code>pw_nonce</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pw_nonce = random_string(256)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Client computes <code>pw</code>, <code>mk</code>, and <code>ak</code> using step (3) from Login Steps.</p></li><li><p>Client registers with <code>email</code>, <code>pw</code>, <code>pw_cost</code>, <code>pw_nonce</code>, and <code>version</code>.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="item-encryption"></a>Item Encryption<a class="hash-link" href="#item-encryption" title="Direct link to heading">#</a></h2><p>In general, when encrypting a string, one should use an IV so that two subsequent encryptions of the same content yield different results, and one should authenticate the data as to ascertain its authenticity and lack of tampering.</p><p>In Standard Notes, two strings are encrypted for every item:</p><ul><li>The item&#x27;s <code>content</code>.</li><li>The item&#x27;s <code>enc_item_key</code>.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="client-side"></a>Client-side<a class="hash-link" href="#client-side" title="Direct link to heading">#</a></h2><p>An item is encrypted using a random key generated for each item.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="encryption"></a>Encryption:<a class="hash-link" href="#encryption" title="Direct link to heading">#</a></h3><p>Note that when encrypting/decrypting data, keys should be converted to the proper format your platform function supports. It&#x27;s best to convert keys to binary data before running through any encryption/hashing algorithm.</p><p>For every item:</p><ol><li>Generate a random 512 bit key <code>item_key</code> (in hex format).</li><li>Split <code>item_key</code> in half; set item encryption key <code>item_ek = first_half</code> and item authentication key <code>item_ak = second_half</code>.</li><li>Encrypt <code>content</code> using <code>item_ek</code> and <code>item_ak</code> following the instructions &quot;Encrypting a string using the 003 scheme&quot; below and send to server as <code>content</code>.</li><li>Encrypt <code>item_key</code> using the global <code>mk</code> and global <code>ak</code> following the instructions &quot;Encrypting a string using the 003 scheme&quot; below and send to server as <code>enc_item_key</code>.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="decryption"></a>Decryption:<a class="hash-link" href="#decryption" title="Direct link to heading">#</a></h3><p>Check the first 3 characters of the <code>content</code> string. This will be the encryption version.</p><ul><li><p>If it is equal to &quot;001&quot;, which is a legacy scheme, decrypt according to the 001 instructions found <a href="https://github.com/standardfile/standardfile.github.io/blob/master/doc/spec-001.md" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p>If it is equal to &quot;002&quot; or &quot;003&quot;, decrypt as follows:</p><ol><li>Decrypt <code>enc_item_key</code> using the global <code>mk</code> and global <code>ak</code> according to the &quot;Decrypting a string using the 003 scheme&quot; instructions below to get <code>item_key</code>.</li><li>Split <code>item_key</code> in half; set encryption key <code>item_ek = first_half</code> and authentication key <code>item_ak = second_half</code>.</li><li>Decrypt <code>content</code> using <code>item_ek</code> and <code>item_ak</code> according to the &quot;Decrypting a string using the 003 scheme&quot; instructions below.</li></ol></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="encrypting-a-string-using-the-003-scheme"></a>Encrypting a string using the 003 scheme:<a class="hash-link" href="#encrypting-a-string-using-the-003-scheme" title="Direct link to heading">#</a></h3><p>Given a <code>string_to_encrypt</code>, an <code>encryption_key</code>, and an <code>auth_key</code>:</p><ol><li>Generate a random 128 bit string called IV.</li><li>Encrypt <code>string_to_encrypt</code> using <code>AES-CBC-256:Base64</code>, <code>encryption_key</code>, and <code>IV</code>:</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ciphertext = AES-Encrypt(string_to_encrypt, encryption_key, IV)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol><li>Generate <code>string_to_auth</code> by combining the encryption version (003), the item&#x27;s UUID, the IV, and the ciphertext using the colon &quot;:&quot; character:</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">string_to_auth = [&quot;003&quot;, uuid, IV, ciphertext].join(&quot;:&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol><li>Compute <code>auth_hash = HMAC-SHA256:Hex(string_to_auth, auth_key)</code>.</li><li>Generate the final result by combining the five components into a <code>:</code> separated string:</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">result = [&quot;003&quot;, auth_hash, uuid, IV, ciphertext].join(&quot;:&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="decrypting-a-string-using-the-003-scheme"></a>Decrypting a string using the 003 scheme:<a class="hash-link" href="#decrypting-a-string-using-the-003-scheme" title="Direct link to heading">#</a></h3><p>Given a <code>string_to_decrypt</code>, an <code>encryption_key</code>, and an <code>auth_key</code>:</p><ol><li>Split the string into its constituent parts: <code>components = string_to_decrypt.split(&quot;:&quot;)</code>.</li><li>Assign local variables:</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">version = components[0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">auth_hash = components[1]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">uuid = components[2]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">IV = components[3]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ciphertext = components[4]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol><li>Ensure that <code>uuid == item.uuid</code>. If not, abort decryption.</li><li>Generate <code>string_to_auth = [version, uuid, IV, ciphertext].join(&quot;:&quot;)</code>.</li><li>Compute <code>local_auth_hash = HMAC-SHA256(string_to_auth, auth_key)</code>. Compare <code>local_auth_hash</code> to <code>auth_hash</code>. If they are not the same, skip decrypting this item, as this indicates that the string has been tampered with.</li><li>Decrypt <code>ciphertext</code> to get final result: <code>result = AES-Decrypt(ciphertext, encryption_key, IV)</code>.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="server-side"></a>Server-side<a class="hash-link" href="#server-side" title="Direct link to heading">#</a></h2><p>For every received item:</p><ol><li>(Optional but recommended) Encrypt <code>content</code> using server known key and store. Decrypt before sending back to client.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="next-steps"></a>Next Steps<a class="hash-link" href="#next-steps" title="Direct link to heading">#</a></h2><p>Join the <a href="https://standardnotes.org/slack" target="_blank" rel="noopener noreferrer">Slack group</a> to discuss implementation details and ask any questions you may have.</p><p>You can also email <a href="mailto:help@standardnotes.org" target="_blank" rel="noopener noreferrer">help@standardnotes.org</a>.</p><p>Follow <a href="https://twitter.com/standardnotes" target="_blank" rel="noopener noreferrer">@standardnotes on Twitter</a> for updates and announcements.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/standardnotes/docs/edit/main/docs/specification/encryption-003.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-12-17T08:04:51.000Z" class="docLastUpdatedAt_1Qna">12/17/2020</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/specification/encryption/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Encryption Protocol Specification v004</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/specification/sync"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Sync Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#version-003" class="table-of-contents__link">Version 0.0.3</a></li><li><a href="#key-generation" class="table-of-contents__link">Key Generation</a><ul><li><a href="#client-instructions" class="table-of-contents__link">Client Instructions</a></li></ul></li><li><a href="#item-encryption" class="table-of-contents__link">Item Encryption</a></li><li><a href="#client-side" class="table-of-contents__link">Client-side</a><ul><li><a href="#encryption" class="table-of-contents__link">Encryption:</a></li><li><a href="#decryption" class="table-of-contents__link">Decryption:</a></li><li><a href="#encrypting-a-string-using-the-003-scheme" class="table-of-contents__link">Encrypting a string using the 003 scheme:</a></li><li><a href="#decrypting-a-string-using-the-003-scheme" class="table-of-contents__link">Decrypting a string using the 003 scheme:</a></li></ul></li><li><a href="#server-side" class="table-of-contents__link">Server-side</a></li><li><a href="#next-steps" class="table-of-contents__link">Next Steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Resources</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/self-hosting/getting-started">Self-host a Sync Server</a></li><li class="footer__item"><a class="footer__link-item" href="/listed/about">Listed Blogging Platform</a></li><li class="footer__item"><a class="footer__link-item" href="/extensions/intro">Build an Extension</a></li><li class="footer__item"><a class="footer__link-item" href="/specification/encryption">Specifications</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://standardnotes.org/slack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Join our Slack</a></li><li class="footer__item"><a href="https://forum.standardnotes.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Forum</a></li><li class="footer__item"><a href="https://listed.to" target="_blank" rel="noopener noreferrer" class="footer__link-item">Listed Blogging Platform</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Support</h4><ul class="footer__items"><li class="footer__item"><a href="https://standardnotes.org/help" target="_blank" rel="noopener noreferrer" class="footer__link-item">Help &amp; Contact</a></li><li class="footer__item"><a href="https://twitter.com/standardnotes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://reddit.com/r/standardnotes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 <a href="https://standardnotes.org">Standard Notes</a></div></div></div></footer></div>
<script src="/styles.f3353c29.js"></script>
<script src="/runtime~main.27aa97a1.js"></script>
<script src="/main.4fbd0b91.js"></script>
<script src="/1.f786a897.js"></script>
<script src="/85.c42d0e7f.js"></script>
<script src="/89.f32036f2.js"></script>
<script src="/935f2afb.6b1e2732.js"></script>
<script src="/84.3088d7e3.js"></script>
<script src="/b2ddf031.08057054.js"></script>
</body>
</html>